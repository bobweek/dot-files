!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}({0:function(e,t,n){"use strict";let o={enableScreenshotEmbedding:!0,enableOpenLocationCode:!0,enableAutomaticScreenshotTagging:!0};t.a={save:e=>browser.storage.sync.set(e),load:()=>browser.storage.sync.get(o),onChange:e=>{browser.storage.onChanged.addListener((function(t){let n={};for(let e in o)n[e]=t[e].newValue;e(n)}))}}},5:function(e,t,n){"use strict";n.r(t);var o=n(0);
/**
 * @copyright Copyright (c) 2016-present, TagSpaces UG (haftungsbeschraenkt).
 * @license AGPL-3.0
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License, version 3,
 * as published by the Free Software Foundation.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License, version 3,
 * along with this program.  If not, see <http://www.gnu.org/licenses/>
 *
 */let i={};o.a.load().then(e=>i=e),$(document).ready((function(){b.then(e=>{for(let t of e){d=t.url,p=t.id,l.href=d,w(),c=H();let e=t.title.trim();e=e.replace(/[/\\?%*:|"<>]/g,"-"),$("#title").val(e),$("#title").focus(),s.indexOf(c)>=0?$("#downloadFile").show():$("#downloadFile").hide()}},e=>{console.warn("Error getting active tab: "+e)}),$("#title").focus(),$("#saveAsMhtml").on("click",a?O:k),$("#closePopup").on("click",()=>window.close()),$("#saveAsBookmark").on("click",M),$("#saveSelectionAsHtml").on("click",z),$("#saveWholePageAsHtml").on("click",A),$("#saveScreenshot").on("click",E),$("#downloadFile").on("click",S),$("#simplifiedPreview").on("click",x),$("#fullPreview").on("click",C),$("[data-i18n]").each((function(){$(this).html(browser.i18n.getMessage($(this).data("i18n")))})),$("[data-i18n-title]").each((function(){$(this).attr("title",browser.i18n.getMessage($(this).data("i18n-title")))})),browser.runtime.onMessage.addListener(y),browser.tabs.executeScript(null,{file:"content-script-capture-wholepage.dist.js"}).then(()=>{console.log("Content script injected...")},e=>{console.warn("Error executing script "+JSON.stringify(e)),$("#preview").contents().find("html").html("Error while capturing content")}),browser.tabs.executeScript(null,{file:"content-script-capture-selection.dist.js"}).then(()=>{console.log("Content script injected...")},e=>{console.warn("Error executing script "+JSON.stringify(e)),$("#preview").contents().find("html").html("Error while capturing content")})})),console.log("Loading Popup...");const r=navigator.appVersion.includes("Win")?"\\":"/",a=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,s=(navigator.userAgent.toLowerCase().indexOf("chrome"),["png","jpg","jpeg","svg","webp","gif","bmp","ico","pdf","ogg","ogv","mp4","mp3"]),l=document.createElement("a");let c,d,p,f,m,h,u='<!DOCTYPE html><html><head><meta charset="UTF-8"><style type="text/css">/*! normalize.css v8.0.0 | MIT License | github.com/necolas/normalize.css */button,hr,input{overflow:visible}progress,sub,sup{vertical-align:baseline}[type=checkbox],[type=radio],legend{box-sizing:border-box;padding:0}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{padding:.35em .75em .625em}legend{color:inherit;display:table;max-width:100%;white-space:normal}textarea{overflow:auto}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}body{overflow:auto;font: Ubuntu,arial,clean,sans-serif;color:#000;line-height:1.4em;background-color:#fff;padding:20px}p{margin:1em 0;line-height:1.5em}table{font:100%;margin:1em}table th{border-bottom:1px solid #bbb;padding:.2em 1em}table td{border-bottom:1px solid #ddd;padding:.2em 1em}input[type=image],input[type=password],input[type=text],textarea{font:99% helvetica,arial,freesans,sans-serif}option,select{padding:0 .25em}optgroup{margin-top:.5em}code,pre{font:12px Monaco, Courier ,monospace}pre{margin:1em 0;font-size:12px;background-color:#eee;border:1px solid #ddd;padding:5px;line-height:1.5em;color:#444;overflow:auto;-webkit-box-shadow:rgba(0,0,0,.07) 0 1px 2px inset;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px}pre code{padding:0;font-size:12px;background-color:#eee;border:none}code{font-size:12px;background-color:#f8f8ff;color:#444;padding:0 .2em;border:1px solid #dedede}img{border:0;max-width:100%}abbr{border-bottom:none}a{color:#4183c4;text-decoration:none}a:hover{text-decoration:underline}a code,a:link code,a:visited code{color:#4183c4}h2,h3{margin:1em 0}h1,h2,h3,h4,h5,h6{border:0}h1{font-size:170%;border-top:4px solid #aaa;padding-top:.5em;margin-top:1.5em}h1:first-child{margin-top:0;padding-top:.25em;border-top:none}h2{font-size:150%;margin-top:1.5em;border-top:4px solid #e0e0e0;padding-top:.5em}h3{font-size:130%;margin-top:1em}h4{font-size:120%;margin-top:1em}h5{font-size:115%;margin-top:1em}h6{font-size:110%;margin-top:1em}hr{border:1px solid #ddd}ol,ul{margin:1em 0 1em 2em}ol li,ul li{margin-top:.5em;margin-bottom:.5em}ol ol,ol ul,ul ol,ul ul{margin-top:0;margin-bottom:0}blockquote{margin:1em 0;border-left:5px solid #ddd;padding-left:.6em;color:#555}dt{font-weight:700;margin-left:1em}dd{margin-left:2em;margin-bottom:1em}</style></head><body></body></html>',g="simplified";const b=browser.tabs.query({currentWindow:!0,active:!0});function w(){const e=new RegExp("(map=|@)(.*),(.*),"),t=new RegExp("\\d/(.*)/(.*)");if(l.href){let n,o,r=l.href.match(e),a=l.href.match(t);if(r&&r.length>1?(n=r[2],o=r[3]):a&&a.length>0&&(n=a[1],o=a[2]),n&&n.length>0&&o&&o.length>0){let e="";if(OpenLocationCode&&i.enableOpenLocationCode)try{e=OpenLocationCode.encode(parseFloat(n),parseFloat(o))}catch(e){console.warn("Error parsing lat long to float")}else o.startsWith("-")||(o="+"+o),e=n+o;const t=document.getElementById("tags").value.trim()+" "+e;t&&t.length>0&&(document.getElementById("tags").value=t.trim())}}}function v(e,t){saveAs(e,t)}function y(e){const t="<style type='text/css'>img, figure, video { max-width: 100%; height: unset; } html { overflow-x: hidden; }</style>";return"htmlcontent"==e.action&&(f=e.originalHTML,m=e.cleanedHTML),"htmlselection"==e.action&&(e.source.length<1||(h=e.source)),h?($("#preview").contents().find("html").html(h),void $("#preview").contents().find("html").append(t)):m?($("#preview").contents().find("html").html(m),$("#preview").contents().find("html").append(t),void(g="simplified")):f?($("#preview").contents().find("html").html(f),void(g="original")):($("#contentModeSwitch").hide(),void $("#preview").contents().find("html").html("No content was extracted..."))}function x(){m&&(g="simplified",$("#preview").contents().find("html").html(m))}function C(){f&&(g="original",$("#preview").contents().find("html").html(f))}function k(){$("#saveAsMhtml i").removeClass("fa-file-image-o").addClass("fa-spin fa-circle-o-notch"),browser.pageCapture.saveAsMHTML({tabId:p},e=>{v(e,j(c,"mht")),$("#saveAsMhtml i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-file-image-o")})}function S(){browser.downloads.download({url:d,filename:j(c),saveAs:!0})}function A(){$("#saveWholePageAsHtml i").removeClass("fa-file").addClass("fa-spin fa-circle-o-notch");let e="";if("simplified"===g?e=m:"original"===g&&(e=f),!e||e.length<1)return alert("No content extracted...."),$("#saveWholePageAsHtml i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-file"),void $("#saveSelectionAsHtml i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-file-text");T(e).then(e=>{v(new Blob([e],{type:"text/html;charset=utf-8"}),j("html")),$("#saveWholePageAsHtml i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-file"),$("#saveSelectionAsHtml i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-file-text")}).catch(e=>{alert("Error by preparing the HTML content..."),location.reload(),console.warn("Error handling html content "+e)})}function z(){if($("#saveSelectionAsHtml i").removeClass("fa-file-text").addClass("fa-spin fa-circle-o-notch"),!h||h.length<1)return alert("No content selected...."),$("#saveWholePageAsHtml i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-file"),void $("#saveSelectionAsHtml i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-file-text");T(h).then(e=>{v(new Blob([e],{type:"text/html;charset=utf-8"}),j("html")),$("#saveWholePageAsHtml i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-file"),$("#saveSelectionAsHtml i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-file-text")}).catch(e=>{alert("Error by preparing the HTML content..."),console.warn("Error handling html content "+e)})}function E(){$("#saveScreenshot i").removeClass("fa-camera").addClass("fa-spin fa-circle-o-notch"),browser.tabs.captureVisibleTab(null,{format:"png"}).then(e=>{v(P(e),j("png","screenshot")),$("#saveScreenshot i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-camera")},e=>console.warn("Error taking screenshot "+JSON.stringify(e)))}function O(){$("#saveAsMhtml i").removeClass("fa-camera").addClass("fa-spin fa-circle-o-notch"),browser.tabs.saveAsPDF({}).then(e=>{v(P(e),j("pdf")),$("#saveAsMhtml i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-camera")},e=>console.warn("Error saving as PDF "+JSON.stringify(e)))}function M(){$("#saveAsBookmark i").removeClass("fa-bookmark").addClass("fa-spin fa-circle-o-notch"),browser.tabs.captureVisibleTab(null,{format:"jpeg",quality:95}).then(e=>{const t=i.enableScreenshotEmbedding?"COMMENT="+e+"\r\n":"";v(new Blob(["[InternetShortcut]\r\nURL="+d+"\r\n"+t],{type:"text/plain;charset=utf-8"}),j("url")),$("#saveAsBookmark i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-bookmark")})}function j(e,t){let n=$("#title").val();const o=n.lastIndexOf(".");o>0&&n.length-o<5&&(n=n.substring(0,n.lastIndexOf(".")));const i=document.getElementById("tags").value.split(","),r=[];for(let e of i){let t=e.trim();t.length>1&&r.push(t)}return"screenshot"===t&&"png"===e.toLowerCase()&&(r.push("screenshot"),r.push(l?l.hostname:""),r.push(function(e,t){if(void 0===e||""===e)return"";const n=new Date(e);let o=n.getDate();o+="",1===o.length&&(o="0"+o);let i=n.getMonth();i++,i+="",1===i.length&&(i="0"+i);const r=n.getFullYear();let a="";if(t){let e=n.getHours();e+="",1===e.length&&(e="0"+e);let t=n.getMinutes();t+="",1===t.length&&(t="0"+t);let o=n.getSeconds();o+="",1===o.length&&(o="0"+o),a="~"+e+t+o}return r+""+i+o+a}((new Date).toString(),!1))),"mht"===t&&(e="mhtml"),"pdf"===t&&(e="pdf"),n=r.length>0?n+" ["+r.join(" ")+"]."+e:n+"."+e,n=n.replace(/[/\\?%*:|"<>]/g,"-").trim(),n}function P(e){const t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(t.length);let i=new Uint8Array(o);for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);const r=new DataView(o);return new Blob([r],{type:n})}function L(e){return new Promise(t=>{const n=document.createElement("canvas"),o=n.getContext("2d"),i=new Image;let r;i.src=e,i.crossOrigin="anonymous",i.onerror=n=>{console.warn("Error fetching image: "+JSON.stringify(n)),t([e,e])},i.onload=()=>{n.width=i.width,n.height=i.height,o.drawImage(i,0,0);try{r=n.toDataURL("image/jpeg",.9),t([e,r])}catch(e){t(["",r])}}})}function H(){let e=d;return l.search&&(e=l.origin+l.pathname),e.replace(/^.*?\.([a-zA-Z0-9]+)$/,"$1").toLowerCase()}function T(e){return new Promise(t=>{let n,o=DOMPurify.sanitize(e);const a=[];let s,c;const p=/<img.*?src=['"](.*?)['"]/g,f=[];for(;null!==(n=p.exec(o));)f.push(n[1]);for(let e of f)e.startsWith("data")||(e.startsWith("http")||e.startsWith("file")||(s=e,d.startsWith("file:")?(c=d.substring(0,d.lastIndexOf(r)+1),e=c+e):e=e.startsWith("/")?l.origin+e:d+e,o=o.split(s).join(e)),a.push(L(e)));Promise.all(a).then(e=>{e.forEach(e=>{o=o.split(' src="'+e[0]).join(' src="'+e[1]),o.includes("src='")&&(o=o.split(" src='"+e[0]).join(" src='"+e[1]))}),browser.tabs.captureVisibleTab(null,{format:"jpeg",quality:95}).then(e=>{let n='\ndata-createdwith="TagSpaces Web Clipper"\ndata-sourceurl="'+d+'" \ndata-scrappedon="'+(new Date).toISOString()+'"';return e&&i.enableScreenshotEmbedding&&(n=n+' \ndata-screenshot="'+e+'"\n'),o.includes("<body")?o=o.split("<body").join("<body "+n):(o="\n<body "+n+">"+o+"</body>",o=u.replace(/<body[^>]*>([^]*)<\/body>/m,o)),t(o)},e=>console.warn("Error taking screenshot "+JSON.stringify(e)))}).catch(e=>(console.warn("Error by preparing content: "+e),t(o)))})}}});
//# sourceMappingURL=popup.dist.js.map